<h1 mat-dialog-title>{{ data.editMode ? 'Edit' : 'Create' }}
  recipe {{data.editMode ? data.recipe.id : ''}}</h1>
<div mat-dialog-content style="height: auto; width: 100%; max-height: 555px">
  <form [formGroup]="form">
    <mat-form-field style="width: 100%" appearance="outline">
      <mat-label>Recipe name</mat-label>
      <input matInput placeholder="Name" formControlName="name">
      <mat-error *ngIf="name!.hasError('required')">Recipe name is required.</mat-error>
      <mat-error *ngIf="name!.hasError('minlength')">Recipe name must be at least 3 characters long.
      </mat-error>
      <mat-error *ngIf="name!.hasError('invalidRecipeName')">This component name is already in use.
      </mat-error>
    </mat-form-field>
    <mat-form-field style="width: 100%" appearance="outline">
      <mat-label>Recipe ID</mat-label>
      <input matInput placeholder="ID" formControlName="id">
      <mat-error *ngIf="id!.hasError('required')">Recipe ID is required.</mat-error>
      <mat-error *ngIf="id!.hasError('minlength') || id!.hasError('maxlength')">Recipe ID must be exactly 10
        characters long.
      </mat-error>
      <mat-error *ngIf="id!.hasError('invalidRecipeId')">This ID is already in use.
      </mat-error>
    </mat-form-field>
    <mat-form-field style="width: 100%" appearance="outline">
      <mat-label>Components</mat-label>
      <mat-chip-list #chipList aria-label="Components selection">
        <mat-chip
          *ngFor="let component of selectedComponents"
          (removed)="remove(component)">
          {{component.name}}
          <button matChipRemove>
            <mat-icon>cancel</mat-icon>
          </button>
        </mat-chip>
        <input
          placeholder="New component..."
          #componentInput
          [formControl]="newComponent"
          [matAutocomplete]="auto"
          [matChipInputFor]="chipList"
          [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
          (matChipInputTokenEnd)="add($event)"
          [readOnly]="selectedComponents.length > 30">
      </mat-chip-list>
      <mat-autocomplete #auto="matAutocomplete" (optionSelected)="selected($event)">
        <mat-option *ngFor="let component of filteredComponents | async" [value]="component">
         <span class="light note">{{component.id}}</span>{{component.name}} | P:{{component.packing.toFixed(1)}}kg
        </mat-option>
      </mat-autocomplete>
    </mat-form-field>

    <div formArrayName="components"
         *ngFor="let component of components.controls; let i = index">
      <div [formGroupName]="i">
        <mat-form-field style="width: 20%" appearance="outline">
          <mat-label>Component ID</mat-label>
          <input matInput readonly formControlName="id" id="componentID{{i}}">
        </mat-form-field>
        <mat-form-field style="width: 50%" appearance="outline">
          <mat-label>Component name</mat-label>
          <input matInput readonly formControlName="name" id="componentName{{i}}">
        </mat-form-field>
        <mat-form-field style="width: 30%" appearance="outline">
          <mat-label>Quantity</mat-label>
          <input matInput placeholder="10" formControlName="quantity" id="componentSP{{i}}"
                 type="number" min="0" onfocus="this.select()">
          <span matSuffix>kg</span>
        </mat-form-field>
      </div>
    </div>
  </form>
</div>
<div mat-dialog-actions>
  <button mat-button [mat-dialog-close]="false">Cancel</button>
  <button mat-button [mat-dialog-close]="getFormValue()" [disabled]="!form.valid || !form.dirty">Save</button>
</div>
